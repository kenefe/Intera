# Intera â€” æ¥åŠ›åè®® (Relay Protocol)

> **ç»™ AI çš„æŒ‡ä»¤ï¼šæ¯æ¬¡æ¥æ‰‹ä»»åŠ¡æ—¶ï¼Œå…ˆè¯»è¿™ä¸ªæ–‡ä»¶ã€‚**

---

## ä½ æ˜¯è°

ä½ æ˜¯ Intera é¡¹ç›®çš„ AI å¼€å‘è€…ä¹‹ä¸€ã€‚è¿™æ˜¯ä¸€ä¸ªäº¤äº’åŠ¨æ•ˆè®¾è®¡å·¥å…·ï¼Œä½¿ç”¨ Vue 3 + TypeScript + Pinia æ„å»ºã€‚

**å»ºé€ é˜¶æ®µåŸºæœ¬å®Œæˆ (Phase 0~8 âœ…, Phase 9 å¯¼å‡º â³, Phase 10 æ‰“ç£¨ ğŸ”§)ã€‚å½“å‰å¤„äºç»´æŠ¤è¿­ä»£æ¨¡å¼ã€‚**

---

## å¿…è¯»æ–‡æ¡£

| ä¼˜å…ˆçº§ | æ–‡ä»¶ | ä»€ä¹ˆæ—¶å€™è¯» |
|---|---|---|
| 1 | `docs/VISION.md` | æ¯æ¬¡éƒ½è¯» â€” äº§å“æ„¿æ™¯ + æ ¸å¿ƒæ¦‚å¿µ |
| 2 | `docs/UI-DESIGN.md` | UX ç›¸å…³ä»»åŠ¡å¿…è¯» â€” ç•Œé¢é•¿ä»€ä¹ˆæ · |
| 3 | `docs/ARCHITECTURE.md` | æ”¹å¼•æ“/æ•°æ®æµæ—¶è¯» â€” ä¸‰å±‚æ¶æ„ |
| 4 | `docs/RULES.md` | æ¯æ¬¡éƒ½è¯» â€” ç¼–ç é“å¾‹ |
| 5 | `docs/KNOWN-ISSUES.md` | ä¿® bug æ—¶è¯» â€” å·²çŸ¥é—®é¢˜è¿½è¸ª |
| 6 | ç›¸å…³ `types.ts` | æ”¹åŠŸèƒ½æ—¶è¯» â€” æ¥å£å®šä¹‰ |

---

## æ ¸å¿ƒæ¦‚å¿µé€Ÿè®°

```
é€»è¾‘çŠ¶æ€ (Variable)    = å˜é‡ (isOpen, tabIndex, cardState: "collapsed"|"expanded")
æ˜¾ç¤ºçŠ¶æ€ (DisplayState) = å…³é”®å¸§ = Folme çš„ state
å…±äº«å›¾å±‚æ ‘              = ä¸€æ£µæ ‘ï¼Œå¤šä¸ªçŠ¶æ€åªå­˜ override å·®å¼‚
çŠ¶æ€ç»„ (StateGroup)    = ç”»å¸ƒä¸Šä¸€"è¡Œ" (ä¸»ç”»é¢ or ç»„ä»¶)
æ›²çº¿ä¸‰çº§è¦†ç›–            = å…¨å±€ â†’ å…ƒç´ çº§ â†’ å±æ€§çº§ (å¯¹åº” Folme çš„ config.special)
ä¸åšæ—¶é—´è½´              = æ›²çº¿ + delay è¶³çŸ£
äº¤äº’é“¾è·¯                = æ‰‹åŠ¿ â†’ é€»è¾‘çŠ¶æ€ â†’ æ˜¾ç¤ºçŠ¶æ€ â†’ folme.to() â†’ å¼¹ç°§åŠ¨æ•ˆ
```

### çŠ¶æ€æ„ŸçŸ¥å†™å…¥ (å…³é”®æ¶æ„çº¦æŸ)

```
é»˜è®¤çŠ¶æ€ (displayStates[0]) ä¿®æ”¹ â†’ updateLayerProps()   â†’ æ”¹åŸºç¡€å±æ€§ â†’ åŒæ­¥æ‰€æœ‰æ— è¦†ç›–çš„çŠ¶æ€
éé»˜è®¤çŠ¶æ€               ä¿®æ”¹ â†’ setOverride()          â†’ åˆ›å»ºè¦†ç›–   â†’ åªå½±å“å½“å‰çŠ¶æ€
```

**æ³¨æ„**: æ‰€æœ‰ä¿®æ”¹å›¾å±‚å±æ€§çš„ä»£ç è·¯å¾„ (PropertiesPanel / useLayerInteraction æ‹–æ‹½ / æœªæ¥æ–°åŠŸèƒ½)
éƒ½å¿…é¡»éµå®ˆæ­¤è§„åˆ™ã€‚å¦åˆ™ç”¨æˆ·åœ¨éé»˜è®¤çŠ¶æ€çš„ä¿®æ”¹ä¼šæ±¡æŸ“æ‰€æœ‰çŠ¶æ€ã€‚

### Level 0 è‡ªåŠ¨å¾ªç¯ (PreviewPanel)

```
æœ‰ Touch Patch â†’ Patch é“¾è·¯æ­£å¸¸å¤„ç†äº¤äº’
æ—  Touch Patch + 2+ çŠ¶æ€ â†’ ç‚¹å‡» Preview è‡ªåŠ¨å¾ªç¯åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ (å¼¹ç°§åŠ¨ç”»)
åªæœ‰ 1 çŠ¶æ€ â†’ æç¤º "ç”»å¸ƒåº•éƒ¨ ï¼‹ æ·»åŠ ç¬¬äºŒä¸ªçŠ¶æ€"
```

---

## ç»´æŠ¤æ¨¡å¼åè®®

### æ¥æ‰‹æ­¥éª¤ (æ¯æ¬¡ä»»åŠ¡éƒ½è¦åš)

1. è¯»æœ¬æ–‡ä»¶ (RELAY.md)
2. è¯» `docs/RULES.md` (ç¼–ç é“å¾‹)
3. ç†è§£ç”¨æˆ·çš„å…·ä½“æŒ‡ä»¤
4. æ ¹æ®æŒ‡ä»¤ç±»å‹ï¼Œæ‰§è¡Œå¯¹åº”æµç¨‹

### é“å¾‹: æ¯æ¬¡æ”¹å®Œéƒ½æäº¤ Git

**æ‰€æœ‰æµç¨‹ (A~E) çš„æœ€åä¸€æ­¥éƒ½æ˜¯ git commitã€‚ä¸æäº¤ = æ²¡åšè¿‡ã€‚**

```
æäº¤å‰è‡ªæ£€ â†’ docs/RULES.md å…«ã€è‡ªæ£€æ¸…å•
æäº¤æ ¼å¼  â†’ fix: / feat: / refactor: / test: / docs: + ç®€è¿°
æäº¤èŒƒå›´  â†’ ä»£ç  + æµ‹è¯• + æ–‡æ¡£ä¸€èµ·æäº¤ï¼Œä¿æŒåŸå­æ€§
```

---

### æµç¨‹ A: ä¿® Bug

```
1. ç†è§£ bug æè¿° (ç°è±¡ + æœŸæœ› + å¤ç°æ­¥éª¤)
2. pnpm dev è·‘èµ·æ¥ï¼Œå¤ç°é—®é¢˜
3. å®šä½æ ¹å›  â€” ä¸æ˜¯æ‰“è¡¥ä¸ï¼æ‰¾åˆ°"ä¸ºä»€ä¹ˆ"
4. å…ˆè¯´ä¿®å¤æ€è·¯ï¼Œç”¨æˆ·ç¡®è®¤ååŠ¨æ‰‹
5. ä¿®æ”¹ä»£ç ï¼Œpnpm build ç¼–è¯‘é€šè¿‡
6. ã€BDD è‡ªåŠ¨ç”Ÿæˆã€‘åœ¨ tests/intera.spec.ts å¯¹åº” Feature ä¸­è‡ªåŠ¨æ·»åŠ å›å½’æµ‹è¯•:
   - æµ‹è¯•å: æè¿°ä¿®å¤åçš„æ­£ç¡®è¡Œä¸º (ä¸æ˜¯æè¿° bug)
   - å¿…é¡»è¦†ç›–è§¦å‘ bug çš„æ“ä½œè·¯å¾„
7. è¿è¡Œ: npx playwright test tests/intera.spec.ts --grep "å¯¹åº”Feature"
8. ã€æ–‡æ¡£åŒæ­¥ã€‘å…¨éƒ¨é€šè¿‡åï¼Œæ›´æ–°å—å½±å“çš„æ–‡æ¡£:
   - docs/KNOWN-ISSUES.md â€” å¿…æ›´æ–° (ä»å¾…ä¿®ç§»åˆ°å·²ä¿®)
   - docs/UI-DESIGN.md â€” è‹¥ä¿®å¤æ”¹å˜äº† UI è¡Œä¸º
   - docs/ARCHITECTURE.md â€” è‹¥ä¿®å¤æ¶‰åŠæ¶æ„/æ•°æ®æµå˜æ›´
   - RELAY.md ä»£ç åœ°å›¾ â€” è‹¥æ–°å¢/é‡å‘½åäº†æ–‡ä»¶æˆ–æ¨¡å—
9. ã€Git æäº¤ã€‘git add + commitï¼Œæ ¼å¼: fix: ç®€è¿°ä¿®å¤å†…å®¹
   ä»£ç  + æµ‹è¯• + æ–‡æ¡£ä¸€èµ·æäº¤ï¼Œä¿æŒåŸå­æ€§
```

### æµç¨‹ B: UX éªŒæ”¶

```
1. pnpm dev è·‘èµ·æ¥
2. è¯» docs/UI-DESIGN.md (ç•Œé¢è§„æ ¼)
3. è¿è¡Œå…¨é‡ BDD: npx playwright test tests/intera.spec.ts
4. æŸ¥çœ‹æˆªå›¾: tests/screenshots/*.png
5. é€é¡¹å¯¹ç…§ UI-DESIGN.md æ£€æŸ¥å„é¡¹åŠŸèƒ½
6. ã€BDD è‡ªåŠ¨è¡¥å…¨ã€‘å‘ç°æœªè¦†ç›–çš„åœºæ™¯ â†’ è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æ·»åŠ åˆ°å¯¹åº” Feature
7. å†æ¬¡è¿è¡Œå…¨é‡ BDDï¼Œç¡®è®¤æ–°å¢æµ‹è¯•é€šè¿‡
8. è¾“å‡º: é—®é¢˜æ¸…å• + BDD é€šè¿‡ç‡
9. ã€Git æäº¤ã€‘git add + commitï¼Œæ ¼å¼: test: UX éªŒæ”¶è¡¥å…¨ BDD è¦†ç›–
```

### æµç¨‹ C: æ”¹åŠŸèƒ½ / åŠ åŠŸèƒ½

```
1. ç†è§£éœ€æ±‚
2. è¯»ç›¸å…³æ–‡æ¡£ + æºç  + reference/ ä¸‹çš„ AS3 å‚è€ƒ
3. å…ˆè¯´æ€è·¯å’Œå½±å“èŒƒå›´ï¼Œç”¨æˆ·ç¡®è®¤åå†åŠ¨æ‰‹
4. æ”¹å®Œ pnpm build ç¼–è¯‘é€šè¿‡
5. ã€BDD è‡ªåŠ¨ç”Ÿæˆã€‘åˆ†ææ–°åŠŸèƒ½è¡Œä¸ºï¼Œè‡ªåŠ¨ç”Ÿæˆæµ‹è¯•:
   - æ–°åŠŸèƒ½ â†’ åœ¨å¯¹åº” Feature åŒºå—æ–°å¢ test()
   - å¦‚æœæ˜¯å…¨æ–°æ¨¡å— â†’ æ–°å¢ test.describe('Feature: XXX') åŒºå—
6. è¿è¡Œ: npx playwright test tests/intera.spec.ts --grep "å¯¹åº”Feature"
7. å…¨éƒ¨é€šè¿‡æ‰ç®—å®Œæˆ
8. ã€æ–‡æ¡£åŒæ­¥ã€‘æ›´æ–°å—å½±å“çš„æ–‡æ¡£ (ç¼ºä¸€ä¸å¯):
   - docs/UI-DESIGN.md â€” æ–°å¢/ä¿®æ”¹ UI å…ƒç´ ã€äº¤äº’æè¿°
   - docs/ARCHITECTURE.md â€” æ–°å¢æ¨¡å—ã€æ•°æ®æµå˜æ›´
   - docs/KNOWN-ISSUES.md â€” è‹¥è§£å†³äº†å·²çŸ¥é—®é¢˜ / äº§ç”Ÿæ–°é™åˆ¶
   - RELAY.md ä»£ç åœ°å›¾ â€” æ–°å¢æ–‡ä»¶ã€æ¨¡å—å…¥å£å˜æ›´
9. ã€Git æäº¤ã€‘git add + commitï¼Œæ ¼å¼: feat: ç®€è¿°æ–°åŠŸèƒ½
   ä»£ç  + æµ‹è¯• + æ–‡æ¡£ä¸€èµ·æäº¤ï¼Œä¿æŒåŸå­æ€§
```

### æµç¨‹ D: é‡æ„ / ä¼˜åŒ–

```
1. è¯´æ˜ä¸ºä»€ä¹ˆè¦é‡æ„ + åˆ—å‡ºå½±å“èŒƒå›´
2. é‡æ„å‰è·‘å…¨é‡ BDD åŸºçº¿: npx playwright test tests/intera.spec.ts (è®°å½•é€šè¿‡æ•°)
3. åˆ†æ­¥æ‰§è¡Œï¼Œæ¯æ­¥ç¼–è¯‘é€šè¿‡
4. æ¯æ­¥å®Œæˆåè·‘å—å½±å“çš„ Feature æµ‹è¯•
5. å…¨éƒ¨å®Œæˆåè·‘å…¨é‡ BDDï¼Œé€šè¿‡æ•° â‰¥ åŸºçº¿
6. ã€BDD è‡ªåŠ¨ä¿®æ­£ã€‘å¦‚æœé‡æ„å¯¼è‡´æµ‹è¯•å¤±è´¥:
   - è¡Œä¸ºä¸å˜ â†’ åªæ›´æ–°æµ‹è¯•ä¸­çš„é€‰æ‹©å™¨/æ–­è¨€ (é€‚é…æ–°ç»“æ„)
   - è¡Œä¸ºæœ‰å˜ â†’ æ›´æ–°æµ‹è¯•åæ˜ æ–°è¡Œä¸ºï¼Œå¹¶å‘ç”¨æˆ·ç¡®è®¤
7. ã€æ–‡æ¡£åŒæ­¥ã€‘æ›´æ–°å—å½±å“çš„æ–‡æ¡£:
   - docs/ARCHITECTURE.md â€” ç»“æ„/å‘½å/æ¨¡å—è¾¹ç•Œå˜æ›´
   - RELAY.md ä»£ç åœ°å›¾ â€” æ–‡ä»¶é‡å‘½åã€ç›®å½•è°ƒæ•´
   - docs/UI-DESIGN.md â€” è‹¥é‡æ„æ”¹å˜äº†ç»„ä»¶æ¥å£æˆ–äº¤äº’
8. ã€Git æäº¤ã€‘git add + commitï¼Œæ ¼å¼: refactor: ç®€è¿°é‡æ„å†…å®¹
   ä»£ç  + æµ‹è¯• + æ–‡æ¡£ä¸€èµ·æäº¤ï¼Œä¿æŒåŸå­æ€§
```

### æµç¨‹ E: è§’è‰²æ—…ç¨‹éªŒè¯ (AI é©±åŠ¨Â·é€æ­¥æ¢ç´¢)

> â›” **ä¸è¦è¿è¡Œ** `npx playwright test tests/persona.spec.ts`ï¼Œé‚£æ˜¯èƒ½åŠ›å›å½’ï¼Œä¸æ˜¯æ—…ç¨‹ã€‚
> âœ… **æ­£ç¡®åšæ³•**: AI è‡ªå·±ç”¨æµè§ˆå™¨å·¥å…· (browser_navigate / browser_click / browser_screenshot)
>    åƒç”¨æˆ·ä¸€æ ·ä¸€æ­¥ä¸€æ­¥æ“ä½œã€‚æ¯æ­¥æˆªå›¾ â†’ çœ‹ç”»é¢ â†’ è¯´å‡ºå†³ç­– â†’ æ“ä½œ â†’ çœ‹ç»“æœã€‚
>    å‘ç°æ‘©æ“¦å°±ä¿®ï¼Œä¿®å®Œé‡èµ°ï¼Œå¾ªç¯è‡³ä¸æ»‘ã€‚

#### èƒ½åŠ›å›¾è°± â†’ ç”»åƒè‡ªåŠ¨ç”Ÿæˆ

```
èƒ½åŠ›å›¾è°±:
  states â”€â”€â”€â”€â”€â”¬â”€â”€ curves â”€â”€â”
              â””â”€â”€ patch â”€â”€â”€â”´â”€â”€ folme
```

æ‰©å±•: åœ¨å›¾è°±åŠ ä¸€ä¸ªèƒ½åŠ› â†’ æ–°ç”»åƒè‡ªåŠ¨æ¶Œç°ã€‚

#### ç”»åƒ + è®¾è®¡ç›®æ ‡

6 ä¸ªç”»åƒä»èƒ½åŠ›å›¾è°±è‡ªåŠ¨æšä¸¾:
âˆ… / {states} / {states,curves} / {states,patch} / {states,curves,patch} / å…¨èƒ½åŠ›

**è®¾è®¡ç›®æ ‡ç”± AI åŠ¨æ€ç”Ÿæˆ**ï¼Œä¸é¢„ç½®ã€‚
AI æ‹¿åˆ°èƒ½åŠ›é›†åï¼Œè‡ªå·±æ„æ€ä¸€ä¸ªå®Œæ•´çš„äº¤äº’åŠ¨æ•ˆè®¾è®¡ä»»åŠ¡ã€‚
- ä»»åŠ¡å¿…é¡»è¦†ç›–è¯¥ç”»åƒçš„æ‰€æœ‰èƒ½åŠ›ï¼Œäº§å‡ºæ˜¯å®Œæˆçš„è®¾è®¡ä½œå“
- åŒä¸€ç”»åƒå¯è·‘ä¸åŒå¤æ‚åº¦ (ç®€å•/ä¸­ç­‰/å¤æ‚)
- å¤šè½®éªŒè¯æ—¶å˜æ¢è®¾è®¡ä»»åŠ¡ï¼Œè¦†ç›–æ›´å¤šåœºæ™¯

#### ç¦æ­¢äº‹é¡¹

- â›” ä¸è¦è¿è¡Œ `npx playwright test tests/persona.spec.ts`ï¼Œé‚£æ˜¯èƒ½åŠ›å›å½’
- â›” ä¸è¦æå‰è§„åˆ’æ‰€æœ‰æ­¥éª¤ï¼Œä¸è¦å†™è„šæœ¬
- â›” ä¸è¦åœ¨æ²¡çœ‹æˆªå›¾çš„æƒ…å†µä¸‹æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œ
- â›” ä¸è¦åå¤æ‰“å¼€å…³é—­æµè§ˆå™¨ã€‚æ‰“å¼€ä¸€æ¬¡ï¼Œå…¨ç¨‹ä¿æŒåŒä¸€çª—å£
- â›” **ä¸è¦å†™å¤šæ­¥åˆå¹¶è„šæœ¬** â€” ç¦æ­¢æŠŠå¤šä¸ªæ“ä½œå†™è¿›ä¸€ä¸ª Playwright/JS è„šæœ¬ä¸€æ¬¡æ€§æ‰§è¡Œå†å›å¤´çœ‹æˆªå›¾ã€‚è¿™å’Œã€Œæå‰è§„åˆ’æ‰€æœ‰æ­¥éª¤ã€æ˜¯å®Œå…¨ç›¸åŒçš„è¿è§„ã€‚æ¯æ¬¡åªæ‰§è¡Œä¸€ä¸ªåŠ¨ä½œï¼Œçœ‹åˆ°ç»“æœå†å†³å®šä¸‹ä¸€æ­¥
- â›” ä¸è¦ç”¨ `npx playwright test` é©±åŠ¨æ—…ç¨‹æ¢ç´¢ã€‚æ—…ç¨‹ç”¨æµè§ˆå™¨å·¥å…·äº¤äº’ï¼Œä¸æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶

#### å·¥å…·: journey-server (å”¯ä¸€æ­£ç¡®æ–¹å¼)

é€šè¿‡ `tests/journey-server.mjs` é€æ­¥æ“ä½œæµè§ˆå™¨ã€‚æ¯æ¬¡ `curl` = ä¸€ä¸ªåŠ¨ä½œ + ä¸€å¼ æˆªå›¾ã€‚
æµè§ˆå™¨ç”± server å¸¸é©»ç®¡ç†ï¼ŒAI æ— æ³•æ‰¹é‡æ‰§è¡Œã€‚

```bash
# å¯åŠ¨ (åå°è¿è¡Œ)
node tests/journey-server.mjs --dir docs/journeys/{æ—…ç¨‹æ–‡ä»¶å¤¹} --port 3900 &

# æ¯æ­¥ä¸€ä¸ª curl (è¿”å› {"step":N,"screenshot":"path"})
# æ‰€æœ‰æ“ä½œéƒ½æ˜¯åæ ‡ + é”®ç›˜ï¼ŒåƒçœŸå®ç”¨æˆ·ä¸€æ ·çœ‹åˆ°ä»€ä¹ˆç‚¹ä»€ä¹ˆ
curl -s localhost:3900/step -d '{"action":"screenshot"}'              # çœ‹å±å¹•
curl -s localhost:3900/step -d '{"action":"mouse","x":500,"y":300}'   # ç‚¹å‡»
curl -s localhost:3900/step -d '{"action":"dblclick","x":100,"y":350}'  # åŒå‡»
curl -s localhost:3900/step -d '{"action":"rightclick","x":100,"y":350}'  # å³é”®
curl -s localhost:3900/step -d '{"action":"hover","x":500,"y":300}'   # æ‚¬åœ
curl -s localhost:3900/step -d '{"action":"drag","x1":400,"y1":200,"x2":600,"y2":400}'  # æ‹–æ‹½
curl -s localhost:3900/step -d '{"action":"press","key":"r"}'         # æŒ‰é”®/å¿«æ·é”®
curl -s localhost:3900/step -d '{"action":"keyboard","text":"Hello"}' # æ‰“å­—
curl -s localhost:3900/step -d '{"action":"scroll","x":900,"y":400,"deltaY":200}'  # æ»šåŠ¨

# ä¿®æ”¹è¾“å…¥æ¡†å€¼çš„æ–¹å¼ (ä¸ç”¨é€‰æ‹©å™¨ï¼Œåƒç”¨æˆ·ä¸€æ ·æ“ä½œ):
#   mouse(x,y) â†’ press("Control+a") â†’ keyboard("360") â†’ press("Enter")
# ä½¿ç”¨ä¸‹æ‹‰æ¡†çš„æ–¹å¼:
#   mouse(x,y) â†’ screenshot â†’ mouse(é€‰é¡¹åæ ‡)

# ç»“æŸ
curl -s localhost:3900/step -d '{"action":"save"}'   # å¯¼å‡º design.intera
curl -s localhost:3900/step -d '{"action":"stop"}'   # å…³é—­æµè§ˆå™¨
```

#### æ ¸å¿ƒåè®®: ä¸€æ¬¡ä¸€æ­¥ï¼Œçœ‹å®Œå†åŠ¨

```
1. é€‰ç”»åƒï¼Œæ„æ€è®¾è®¡ä»»åŠ¡ï¼Œä¸è§„åˆ’æ­¥éª¤
2. å¯åŠ¨ journey-server (åå°ï¼Œæµè§ˆå™¨å¸¸é©»)
3. å¾ªç¯ {
     a. curl screenshot â†’ Read æˆªå›¾æ–‡ä»¶æŸ¥çœ‹
     b. æè¿°æˆªå›¾ä¸­çœ‹åˆ°äº†ä»€ä¹ˆ (å…·ä½“ç”»é¢å†…å®¹)
     c. åŸºäºç”»é¢ + è®¾è®¡ä»»åŠ¡ï¼Œå†³å®šä¸‹ä¸€æ­¥ (åªå†³å®šä¸€æ­¥)
     d. curl æ‰§è¡Œè¿™ä¸€æ­¥ â†’ Read æˆªå›¾æŸ¥çœ‹ç»“æœ
     e. å›åˆ° b
   }
4. è®¾è®¡ä»»åŠ¡å®Œæˆ â†’ å½’æ¡£æ—…ç¨‹ (README.md + design.intera + æˆªå›¾)
5. æ‘©æ“¦ç‚¹åŒæ­¥åˆ° docs/KNOWN-ISSUES.md æ‘©æ“¦æ—¥å¿—   â† âš ï¸ ä¸å¯è·³è¿‡
6. git add + git commit æ—…ç¨‹å½’æ¡£   â† âš ï¸ ä¸å¯è·³è¿‡
7. æœ‰æ‘©æ“¦ â†’ ä¿®ä»£ç  â†’ git commit ä»£ç ä¿®æ”¹ â†’ èƒ½åŠ›å›å½’ç¡®è®¤æ²¡å â†’ é‡èµ°æ—…ç¨‹
8. æ— æ‘©æ“¦ â†’ æ ‡è®° âœ… â†’ ä¸‹ä¸€ç”»åƒï¼Œä¾ç„¶èµ°æµç¨‹E
```

**æ“ä½œåå¥½ (åƒçœŸå®è®¾è®¡å¸ˆ â€” é›¶é€‰æ‹©å™¨)**:
- **åªæœ‰åæ ‡å’Œé”®ç›˜** â€” ä»æˆªå›¾ä¼°ç®—ä½ç½®ï¼Œç”¨ `mouse`/`drag`/`dblclick`/`rightclick`/`hover`ã€‚é€‰æ‹©å™¨å·²ä» server ç§»é™¤
- **æ‹–æ‹½ > è¾“å…¥æ¡†** â€” è°ƒæ•´å°ºå¯¸/ä½ç½®æ—¶ä¼˜å…ˆæ‹–æ‹½æ‰‹æŸ„
- **æ”¹è¾“å…¥æ¡†å€¼** â€” `mouse` ç‚¹å‡»è¾“å…¥æ¡† â†’ `press("Control+a")` å…¨é€‰ â†’ `keyboard("æ–°å€¼")` â†’ `press("Enter")`
- **ç”¨ä¸‹æ‹‰æ¡†** â€” `mouse` ç‚¹å‡»ä¸‹æ‹‰ â†’ `screenshot` çœ‹é€‰é¡¹ â†’ `mouse` ç‚¹å‡»é€‰é¡¹åæ ‡
- **æ»šåŠ¨** â€” `scroll` ä¼ é¼ æ ‡ä½ç½® (x,y) å’Œæ»šåŠ¨é‡ (deltaX/deltaY)
- **ç¦æ­¢ eval / ç¦æ­¢é€‰æ‹©å™¨** â€” server ä¸æä¾›è¿™äº›èƒ½åŠ›ï¼Œä»æ¶æ„ä¸Šæœç»

**äº§å“å¿«æ·é”® (è®¾è®¡å¸ˆå¸¸ç”¨)**:
| æŒ‰é”® | åŠŸèƒ½ |
|---|---|
| `v` | é€‰æ‹©å·¥å…· |
| `r` | çŸ©å½¢å·¥å…· |
| `o` | æ¤­åœ†å·¥å…· |
| `f` | Frame å·¥å…· |
| `t` | æ–‡æœ¬å·¥å…· |
| `Arrow` | å¾®è°ƒé€‰ä¸­å›¾å±‚ 1px |
| `Shift+Arrow` | å¾®è°ƒé€‰ä¸­å›¾å±‚ 10px |
| `Delete` / `Backspace` | åˆ é™¤é€‰ä¸­å›¾å±‚ |
| `Ctrl+Z` | æ’¤é”€ |
| `Ctrl+Shift+Z` | é‡åš |
| `Ctrl+S` | ä¿å­˜ |

**å…³é”®**:
- AI ä¸çŸ¥é“äº§å“æ“ä½œæ–¹å¼ï¼Œé€šè¿‡çœ‹ç”»é¢æ¢ç´¢
- è®¾è®¡ç›®æ ‡ç”± AI è‡ªå·±æ„æ€ï¼Œä¸æ˜¯é¢„ç½®è„šæœ¬
- äº§å‡ºæ˜¯ä¸€ä¸ªå®Œæˆçš„äº¤äº’åŠ¨æ•ˆè®¾è®¡ä½œå“

**é“å¾‹ â€” ä¸å¯è¿å**:
- â›” **æ¯ä¸ªç”»åƒè´¨é‡ä¸€è‡´** â€” ç¬¬ 6 ä¸ªç”»åƒå’Œç¬¬ 1 ä¸ªç”»åƒå¿…é¡»ä¸€æ ·è¯¦ç»†ã€‚æ¯ä¸€æ­¥éƒ½å¿…é¡»æœ‰æˆªå›¾ + æè¿° + å†³ç­–ã€‚ä¸å…è®¸åé¢çš„ç”»åƒè‰ç‡æ¦‚æ‹¬æˆ–æ‰¹é‡å¤„ç†
- â›” **æ‘©æ“¦ç‚¹åŒå†™** â€” æ¯æ¡æ‘©æ“¦ç‚¹å¿…é¡»åŒæ—¶å†™å…¥ä¸¤å¤„: (1) æ—…ç¨‹ README.md çš„ã€Œæ‘©æ“¦ç‚¹ã€åŒº (2) `docs/KNOWN-ISSUES.md` çš„ã€Œæ‘©æ“¦æ—¥å¿—ã€è¡¨ã€‚åªå†™ä¸€å¤„ = æ²¡å†™
- â›” **æ‘©æ“¦ç‚¹å¿…é¡»ä¿®å¤** â€” å‘ç°æ‘©æ“¦ä¸æ˜¯è®°ç¬”è®°ã€‚æ—…ç¨‹ç»“æŸåå¿…é¡»: è®°å½•åˆ° README + KNOWN-ISSUES â†’ ä¿®ä»£ç  â†’ git commit ä¿®å¤ â†’ è·‘èƒ½åŠ›å›å½’ â†’ é‡èµ°æ—…ç¨‹éªŒè¯ä¿®å¤ç”Ÿæ•ˆã€‚æ‘©æ“¦æœªä¿®å¤çš„æ—…ç¨‹ç»“è®ºåªèƒ½æ˜¯ã€Œæœ‰æ‘©æ“¦å¾…ä¿®ã€ï¼Œä¸èƒ½æ ‡ âœ…
- â›” **æ‘©æ“¦ä¿®å¤å¾ªç¯** â€” æ—…ç¨‹å‘ç°æ‘©æ“¦ â†’ ä¿®ä»£ç  â†’ commit â†’ å›å½’æµ‹è¯• â†’ ç”¨åŒä¸€ç”»åƒé‡èµ°æ—…ç¨‹ã€‚å¾ªç¯ç›´åˆ°è¯¥ç”»åƒé›¶æ‘©æ“¦æ‰èƒ½æ ‡ âœ… è¿›å…¥ä¸‹ä¸€ç”»åƒ
- â›” **ä»£ç Â·æµ‹è¯•Â·æ–‡æ¡£ä¸‰ä½ä¸€ä½“** â€” ä»»ä½•åŠŸèƒ½ä¿®æ”¹/æ–°å¢/ä¿®å¤ï¼Œå¿…é¡»åŒæ—¶æ›´æ–°: (1) ä»£ç  (2) BDD æµ‹è¯• (`tests/intera.spec.ts`) (3) ç›¸å…³æ–‡æ¡£ (`UI-DESIGN.md`/`ARCHITECTURE.md`/`KNOWN-ISSUES.md`/`RELAY.md` ä»£ç åœ°å›¾)ã€‚ä¸‰è€…å¿…é¡»åœ¨åŒä¸€æ¬¡ commit ä¸­å®Œæˆã€‚ç¼ºä»»ä½•ä¸€é¡¹ = æœªå®Œæˆ

#### æ—…ç¨‹å½’æ¡£

æ¯æ¬¡æ—…ç¨‹å®Œæˆåï¼Œè¿½åŠ ä¸€ä»½å½’æ¡£ã€‚æ¯æ¬¡æ–°å»ºæ–‡ä»¶ï¼Œä¸è¦†ç›–ã€‚

æ–‡ä»¶ç»“æ„:
```
docs/journeys/{YYYYMMDD_HHmm}-{ç”»åƒid}-{ç®€è¿°}/    â† æ—¶é—´ç”¨åŒ—äº¬æ—¶é—´ (GMT+8)
  README.md          â† æ—…ç¨‹è®°å½• (è¿‡ç¨‹ + ç»“è®º)
  design.intera      â† æœ€ç»ˆè®¾è®¡æ–‡ä»¶
  screenshots/
    step-01.png
    step-02.png
    ...
```

README.md å†…å®¹:
- **ç”»åƒ**: èƒ½åŠ›é›†
- **è®¾è®¡ç›®æ ‡**: AI æ„æ€çš„è®¾è®¡ä»»åŠ¡
- **è¿‡ç¨‹**: æ¯æ­¥çš„æˆªå›¾è·¯å¾„ + çœ‹åˆ°äº†ä»€ä¹ˆ + å†³ç­– + ç»“æœ
- **æ‘©æ“¦ç‚¹**: é‡åˆ°çš„å›°éš¾å’Œæ”¹è¿›å»ºè®® (åŒæ­¥åˆ° `docs/KNOWN-ISSUES.md` æ‘©æ“¦æ—¥å¿—)
- **ç»“è®º**: é€šè¿‡ / æœ‰æ‘©æ“¦å¾…ä¿®

è®¾è®¡æ–‡ä»¶è·å–: æ—…ç¨‹ç»“æŸæ—¶é€šè¿‡æµè§ˆå™¨æ§åˆ¶å°è¯»å– `localStorage.getItem('intera_project')` ä¿å­˜ä¸º `design.intera`

#### âš ï¸ æ‰€æœ‰ä¿®æ”¹å¿…é¡»æäº¤ git

**æ—…ç¨‹å½’æ¡£**å®Œæˆåï¼Œç«‹å³æäº¤:
```bash
git add docs/journeys/{æ—…ç¨‹æ–‡ä»¶å¤¹}/
git commit -m "journey: {ç”»åƒid} â€” {è®¾è®¡ç›®æ ‡ç®€è¿°}"
```

**ä¿®ä»£ç **åï¼Œä¹Ÿå¿…é¡»ç«‹å³æäº¤:
```bash
git add -A
git commit -m "fix: {ä¿®å¤äº†ä»€ä¹ˆæ‘©æ“¦ç‚¹}"
```

ä¸æäº¤ = ä¸å­˜åœ¨ã€‚æ—…ç¨‹å½’æ¡£å’Œä»£ç ä¿®å¤éƒ½ä¸å¯è·³è¿‡ git commitã€‚

#### ä¸¤å±‚éªŒè¯ä½“ç³»

| | æ—…ç¨‹æ¢ç´¢ (Flow E) | èƒ½åŠ›å›å½’ (persona.spec.ts) |
|--|--|--|
| **æ‰§è¡Œè€…** | AI çœ‹æˆªå›¾é€æ­¥æ“ä½œ | Playwright è‡ªåŠ¨è·‘ |
| **å†³ç­–è€…** | AI (æ¯æ­¥çœ‹ç”»é¢å†³å®š) | ä»£ç  (ç¡®å®šæ€§åºåˆ—) |
| **éªŒè¯ä»€ä¹ˆ** | ä½“éªŒæ˜¯å¦ä¸æ»‘ | åŠŸèƒ½æ˜¯å¦å®Œå¥½ |
| **ä½•æ—¶è·‘** | æ‰“ç£¨ä½“éªŒæ—¶ | ä¿®å®Œä»£ç åå›å½’ |

---

### æµç¨‹ F: æäº¤è‡ªå®¡ (æ¯æ¬¡ commit å‰å¿…åš)

> æ¯æ¬¡ `git add` ä¹‹åã€`git commit` ä¹‹å‰ï¼Œé€é¡¹ç¡®è®¤ä»¥ä¸‹ checklistã€‚
> ä»»ä½•ä¸€é¡¹æœªé€šè¿‡ â†’ å…ˆä¿®å†æäº¤ã€‚ä¸å…è®¸"å…ˆæäº¤åè¡¥"ã€‚

```
è‡ªå®¡ Checklist:

â–¡ ä¸‰ä½ä¸€ä½“
  - [ ] ä»£ç æ”¹äº† â†’ å¯¹åº” BDD æµ‹è¯•æœ‰æ²¡æœ‰ï¼Ÿ(æ–°åŠŸèƒ½=æ–°æµ‹è¯•, Bugä¿®å¤=å›å½’æµ‹è¯•, è¡Œä¸ºå˜æ›´=æ›´æ–°æ–­è¨€)
  - [ ] æ–‡æ¡£éœ€ä¸éœ€è¦æ›´æ–°ï¼Ÿé€ä¸ªæ£€æŸ¥:
        UI-DESIGN.md    â€” UI/äº¤äº’/å¿«æ·é”®å˜æ›´
        ARCHITECTURE.md â€” æ•°æ®æµ/æ¨¡å—/æ¶æ„å˜æ›´
        RELAY.md        â€” ä»£ç åœ°å›¾/BDDè¦†ç›–è¡¨/æµç¨‹å˜æ›´
        KNOWN-ISSUES.md â€” Bugä¿®å¤/æ–°å‘ç°é—®é¢˜
  - [ ] ä»£ç +æµ‹è¯•+æ–‡æ¡£åœ¨åŒä¸€æ¬¡ commit ä¸­

â–¡ ç¼–ç é“å¾‹
  - [ ] çº¯ TS â‰¤ 200 è¡Œï¼ŸVue SFC â‰¤ 400 è¡Œï¼Ÿ
  - [ ] å‡½æ•° â‰¤ 20 è¡Œï¼Ÿç¼©è¿› â‰¤ 3 å±‚ï¼Ÿ
  - [ ] æ—  any / æ—  @ts-ignoreï¼Ÿ
  - [ ] Engine å±‚æ—  UI ä¾èµ–ï¼Ÿ

â–¡ è´¨é‡
  - [ ] pnpm build ç¼–è¯‘é€šè¿‡ï¼Ÿ
  - [ ] ç›¸å…³ Feature BDD æµ‹è¯•é€šè¿‡ï¼Ÿ
  - [ ] git diff é‡Œæœ‰æ²¡æœ‰é—æ¼çš„æ–‡ä»¶ï¼Ÿ

â–¡ è®°å¿†åŒæ­¥
  - [ ] memory/YYYY-MM-DD.md æ›´æ–°äº†ï¼Ÿ
  - [ ] graph.json æ¦‚å¿µå…±ç° edge weight +1ï¼Ÿ
  - [ ] é¡¹ç›® node status éœ€è¦æ›´æ–°ï¼Ÿ
```

**æ‰§è¡Œæ–¹å¼**: AI åœ¨ commit message æœ«å°¾é™„åŠ  `[Fâœ“]` æ ‡è®°è¡¨ç¤ºå·²å®Œæˆè‡ªå®¡ã€‚
ç¼ºå°‘ `[Fâœ“]` çš„ commit åœ¨ Flow G review æ—¶ä¼šè¢«æ ‡è®°ä¸ºè¿è§„ã€‚

---

### æµç¨‹ G: å®šæœŸ Review (æ¯ 10 commits æˆ–æ¯è½® Flow E å)

> è§¦å‘æ¡ä»¶: (1) ç´¯è®¡ 10 ä¸ªæ–° commit (2) æ¯è½® Flow E ç»“æŸå (3) kenefe è¦æ±‚æ—¶
> ç›®çš„: å…œåº•å®¡æŸ¥ï¼Œé˜²æ­¢è‡ªå®¡é—æ¼

```
Review æµç¨‹:

1. åˆ—å‡ºå¾…å®¡ commits: git log --oneline (ä¸Šæ¬¡ review ä¹‹åçš„)
2. é€ä¸ªæ£€æŸ¥ä¸‰ä½ä¸€ä½“:
   - git show --stat <hash> â†’ æœ‰ä»£ç æ”¹åŠ¨çš„ commit æ˜¯å¦åŒ…å«æµ‹è¯•å’Œæ–‡æ¡£ï¼Ÿ
   - ç¼ºå¤±çš„æ ‡è®°ä¸º âŒï¼Œè®°å½•åˆ° review report
3. æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥:
   - RELAY.md ä»£ç åœ°å›¾ vs å®é™…æ–‡ä»¶ (find src -name "*.ts" -o -name "*.vue")
   - RELAY.md BDD è¦†ç›–è¡¨ vs å®é™…æµ‹è¯•æ•° (grep -c "test('" tests/intera.spec.ts)
   - PHASES.md é˜¶æ®µçŠ¶æ€ vs å®é™…å®Œæˆåº¦
   - RULES.md è¡Œæ•°é™åˆ¶ vs å®é™…æ–‡ä»¶è¡Œæ•°
4. å…¨é‡ BDD å›å½’: npx playwright test tests/intera.spec.ts
5. è¾“å‡º Review Report:
   - è¿è§„ commits åˆ—è¡¨ + éœ€è¦è¡¥çš„å†…å®¹
   - æ–‡æ¡£ä¸ä¸€è‡´é¡¹
   - BDD é€šè¿‡ç‡
6. ä¿®å¤æ‰€æœ‰è¿è§„é¡¹
7. git commit -m "review: ç¬¬Nè½®å®¡æŸ¥ä¿®å¤ [Fâœ“]"
```

**Review Report æ ¼å¼**:
```
## Review #N â€” YYYY-MM-DD

å®¡æŸ¥èŒƒå›´: <commit_from>..<commit_to> (N commits)

### ä¸‰ä½ä¸€ä½“åˆè§„
| Commit | ä»£ç  | æµ‹è¯• | æ–‡æ¡£ | åˆ¤å®š |
|--------|------|------|------|------|
| abc1234 feat: xxx | âœ… | âŒ | âŒ | è¿è§„ |

### æ–‡æ¡£ä¸€è‡´æ€§
- RELAY.md ä»£ç åœ°å›¾: âœ…/âŒ (ç¼º N ä¸ªæ–‡ä»¶)
- BDD è¦†ç›–è¡¨: âœ…/âŒ (å®é™… M é¡¹ vs è®°å½• K é¡¹)
- RULES.md è¡Œæ•°: âœ…/âŒ (N ä¸ªæ–‡ä»¶è¶…æ ‡)

### BDD å›å½’
- é€šè¿‡: M/N

### ä¿®å¤é¡¹
1. ...
```

---

## ä»£ç åœ°å›¾

### Engine å±‚ (`src/engine/`) â€” çº¯ TypeScriptï¼Œé›¶ UI ä¾èµ–

| æ¨¡å— | æ ¸å¿ƒæ–‡ä»¶ | èŒè´£ |
|---|---|---|
| **Folme** | `folme/Timeline.ts` | å…¨å±€ rAF å¾ªç¯ï¼ŒdeltaTimeï¼Œè‡ªåŠ¨å¯åœ |
| | `folme/forces/Spring.ts` | é˜»å°¼å¼¹ç°§ (Apple é£æ ¼ response+damping) |
| | `folme/forces/Friction.ts` | æ‘©æ“¦åŠ›è¡°å‡ |
| | `folme/forces/Immediate.ts` | ç«‹å³å†»ç»“ |
| | `folme/Ani.ts` | å•å±æ€§åŠ¨ç”»å®ä¾‹ (åŒæ¨¡é©±åŠ¨: Force/Easing) |
| | `folme/AniRequest.ts` | åŠ¨ç”»è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ + è¾¹ç•Œå¤„ç† |
| | `folme/FolmeManager.ts` | å…ƒç´ çº§åŠ¨ç”»ç®¡ç† (to/setTo/cancel) |
| | `folme/index.ts` | barrel export (FolmeManager + SpringEngine) |
| | `folme/Easing.ts` | ç¼“åŠ¨æ’å€¼å™¨ + è´å¡å°” |
| | `folme/FolmeEase.ts` | æ›²çº¿å·¥å‚ |
| **æ‰‹åŠ¿** | `gesture/SpeedTracker.ts` | é€Ÿåº¦è¿½è¸ª (æƒ¯æ€§ç”¨) |
| | `gesture/GestureEngine.ts` | åŸå§‹è§¦æ§äº‹ä»¶å¤„ç† |
| | `gesture/DragEngine.ts` | æ‹–æ‹½ + æ©¡çš®ç­‹ + æƒ¯æ€§ + å¸é™„ |
| **åœºæ™¯** | `scene/types.ts` | ç±»å‹ barrel (re-export SceneTypes + PatchTypes) |
| | `scene/SceneTypes.ts` | å›¾å±‚/çŠ¶æ€/æ›²çº¿ç±»å‹å®šä¹‰ |
| | `scene/PatchTypes.ts` | Patch èŠ‚ç‚¹ discriminated union ç±»å‹ |
| | `scene/SceneGraph.ts` | å›¾å±‚æ ‘ CRUD |
| | `scene/DisplayState.ts` | æ˜¾ç¤ºçŠ¶æ€ + override ç®¡ç† |
| | `scene/SmartAnimate.ts` | çŠ¶æ€å·®å¼‚ â†’ folme.to() è°ƒç”¨ |
| **äº¤äº’** | `state/VariableManager.ts` | é€»è¾‘å˜é‡ get/set/toggle |
| | `state/PatchRuntime.ts` | Patch å›¾æ‰§è¡Œå¼•æ“ (Map ç´¢å¼• + å®šæ—¶å™¨ç®¡ç†) |
| | `state/PatchDefs.ts` | Patch èŠ‚ç‚¹ç«¯å£å®šä¹‰ + å·¥å‚ |
| | `state/BehaviorManager.ts` | Behavior èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸ (create/destroy) |
| | `state/SugarPresets.ts` | ä¸€é”®é¢„è®¾ |
| **åŸºç¡€** | `idFactory.ts` | ç»Ÿä¸€ ID ç”Ÿæˆå·¥å‚ |
| **å¯¼å‡º** | `export/CSSExporter.ts` | ç‹¬ç«‹ HTML å¯¼å‡º (å†…åµŒå¼¹ç°§å¼•æ“) |
| | `export/LottieExporter.ts` | Lottie JSON |
| | `export/VideoExporter.ts` | WebM è§†é¢‘ (Canvas2D + MediaRecorder) |
| | `export/SpringSim.ts` | å¯¼å‡ºç”¨å¼¹ç°§æ¨¡æ‹Ÿå™¨ (ç‹¬ç«‹äº folmeï¼ŒåµŒå…¥å¯¼å‡ºäº§ç‰©) |
| | `export/resolve.ts` | çŠ¶æ€å±æ€§è§£æ (å¯¼å‡ºæ—¶åˆå¹¶ override) |
| **å…¶ä»–** | `UndoManager.ts` | é€šç”¨æ’¤é”€/é‡åšæ ˆ |
| | `ProjectStorage.ts` | localStorage + æ–‡ä»¶ IO |

### UI å±‚ (`src/components/`)

| ç›®å½• | æ–‡ä»¶ | èŒè´£ |
|---|---|---|
| `canvas/` | `CanvasViewport.vue` | ç”»å¸ƒå®¹å™¨ (ç¼©æ”¾/å¹³ç§»/äº‹ä»¶åˆ†å‘) |
| | `ArtboardGrid.vue` | å¤šçŠ¶æ€ç½‘æ ¼å¸ƒå±€ |
| | `Artboard.vue` | å•ä¸ªç”»æ¿æ¸²æŸ“ |
| | `StateBar.vue` | çŠ¶æ€æ  (åˆ‡æ¢/æ–°å¢çŠ¶æ€) |
| | `SelectionOverlay.vue` | é€‰ä¸­å›¾å±‚çš„è¾¹æ¡†/æ‰‹æŸ„/å¤šé€‰æ¡† |
| `panels/` | `PreviewPanel.vue` | å®æ—¶äº¤äº’é¢„è§ˆé¢æ¿ (å·¦æ å¸¸é©») |
| | `LayerPanel.vue` | å›¾å±‚æ ‘é¢æ¿ |
| | `LayerIcon.vue` | å›¾å±‚ç±»å‹å›¾æ ‡ (çŸ©å½¢/æ¤­åœ†/Frame/æ–‡æœ¬) |
| | `PropertiesPanel.vue` | å±æ€§æ£€æŸ¥å™¨ (ä½ç½®/å°ºå¯¸/å˜æ¢ + å­ç»„ä»¶å§”æ‰˜) |
| | `PropTextGroup.vue` | æ–‡æœ¬å±æ€§å­ç»„ä»¶ (å­—å·/å­—ä½“/å­—é‡/å¯¹é½) |
| | `PropLayoutGroup.vue` | å¸ƒå±€å±æ€§å­ç»„ä»¶ (æ–¹å‘/é—´è·ï¼Œä»…å®¹å™¨) |
| | `PropAppearanceGroup.vue` | å¤–è§‚å±æ€§å­ç»„ä»¶ (é€æ˜åº¦/å¡«å……/æè¾¹/åœ†è§’) |
| | `KeyPropertyPanel.vue` | å…³é”®å±æ€§æ ‡è®° |
| | `CurvePanel.vue` | æ›²çº¿ç¼–è¾‘ (ä¸‰çº§è¦†ç›–) |
| | `CurveEdit.vue` | æ›²çº¿å¯è§†åŒ–ç¼–è¾‘ (slider + ç²¾ç¡®æ•°å€¼è¾“å…¥) |
| `patch/` | `PatchCanvas.vue` | Patch ç¼–è¾‘å™¨ç”»å¸ƒ |
| | `PatchNode.vue` | å•ä¸ª Patch èŠ‚ç‚¹ (ç«¯å£+å†…è”é…ç½®) |
| | `patch-config.css` | é…ç½®åŒºå…±äº«æ ·å¼ |
| | `PatchVarPanel.vue` | å˜é‡ç®¡ç†é¢æ¿ (å¢åˆ æ”¹å/ç±»å‹/é»˜è®¤å€¼ï¼Œå¯æŠ˜å ) |
| æ ¹çº§ | `ContextMenu.vue` | å³é”®èœå• |
| | `ExportDialog.vue` | å¯¼å‡ºå¯¹è¯æ¡† |
| | `App.vue` | æ ¹ç»„ä»¶ (å››æ å¸ƒå±€ + Patch è¡Œ) |
| | `main.ts` | åº”ç”¨å…¥å£ (createApp + Pinia) |

### Store å±‚ (`src/store/`)

| æ–‡ä»¶ | èŒè´£ |
|---|---|
| `project.ts` | é¡¹ç›®æ•°æ®ä¸­æ¢ (å›¾å±‚/çŠ¶æ€/åŠ¨ç”»/æ’¤é”€/æŒä¹…åŒ–) |
| `editor.ts` | å·¥å…·é€‰æ‹© + Patch é¢æ¿å¼€å…³ |
| `canvas.ts` | è§†å£ (zoom/pan) + é€‰åŒº |
| `patch.ts` | Patch ç¼–è¾‘å™¨çŠ¶æ€ (å˜é‡ add/remove/update + Patch CRUD + è¿è¡Œæ—¶) |

### å…¶ä»–

| æ–‡ä»¶ | èŒè´£ |
|---|---|
| `renderer/DOMRenderer.ts` | DOM æ¸²æŸ“å™¨ (å®ç° Renderer æ¥å£) |
| `renderer/types.ts` | Renderer æŠ½è±¡æ¥å£ |
| `composables/useLayerInteraction.ts` | å›¾å±‚é€‰æ‹© + æ‹–æ‹½ç§»åŠ¨ |
| `composables/useLayerDrag.ts` | å›¾å±‚æ‹–æ‹½ç»†èŠ‚ (åç§»è®¡ç®—) |
| `composables/useDrawTool.ts` | ç»˜åˆ¶å·¥å…· (çŸ©å½¢/æ¤­åœ†/Frame) |
| `composables/useTextTool.ts` | æ–‡æœ¬å·¥å…· (ç‚¹å‡»åˆ›å»º + contenteditable) |
| `composables/usePreviewGesture.ts` | é¢„è§ˆæ¨¡å¼æ‰‹åŠ¿ç»‘å®š (Patch è§¦å‘ + Behavior é©±åŠ¨) |
| `composables/useKeyboard.ts` | å…¨å±€å¿«æ·é”® (å·¥å…·/æ’¤é”€/ä¿å­˜/æ‰“å¼€/æ–¹å‘é”®å¾®è°ƒ) |
| `composables/useTransition.ts` | çŠ¶æ€åˆ‡æ¢è¿‡æ¸¡è¾…åŠ© |
| `reference/` | AS3 æºç å‚è€ƒ (åªè¯»ï¼Œä¸è¦ä¿®æ”¹) |

---

## å‚è€ƒ: AS3 æºç æ˜ å°„

å½“éœ€è¦å¯¹ç…§åŸå§‹å®ç°æ—¶:

| TypeScript | AS3 å‚è€ƒ |
|---|---|
| `folme/Timeline.ts` | `reference/folme/Timeline.as` |
| `folme/forces/Spring.ts` | `reference/folme/force/Spring.as` |
| `folme/FolmeManager.ts` | `reference/folme/FolmeManager.as` |
| `folme/Ani.ts` | `reference/folme/Ani.as` |
| `folme/AniRequest.ts` | `reference/folme/AniRequest.as` |
| `gesture/DragEngine.ts` | `reference/folme/FolmeDrag.as` |
| `gesture/SpeedTracker.ts` | `reference/folme/SpeedTracker.as` |
| `gesture/GestureEngine.ts` | `reference/MouseAction.as` |

---

## æµè§ˆå™¨éªŒè¯ (Playwright)

é¡¹ç›®å·²é…ç½® Playwright + Chromiumï¼Œå¯è‡ªåŠ¨åŒ–éªŒè¯ UI äº¤äº’ã€‚

### å¿«é€Ÿå‘½ä»¤

```bash
# ç¡®ä¿ dev server åœ¨è·‘
pnpm dev &

# å…¨é‡ BDD æµ‹è¯• (66 é¡¹)
npx playwright test tests/intera.spec.ts --reporter=list

# åªè·‘æŸä¸ª Feature (ç”¨ --grep)
npx playwright test tests/intera.spec.ts --grep "ç»˜å›¾å·¥å…·"
npx playwright test tests/intera.spec.ts --grep "ç»˜å›¾å·¥å…·|å›¾å±‚ç®¡ç†"

# ç»¼åˆå†’çƒŸ (æœ€å¿«)
npx playwright test tests/intera.spec.ts --grep "ç»¼åˆé›†æˆ"

# æŸ¥çœ‹æˆªå›¾
ls tests/screenshots/
```

### BDD Feature è¦†ç›– (tests/intera.spec.ts)

| Feature | æµ‹è¯•æ•° | è¦†ç›–å†…å®¹ |
|---|---|---|
| åº”ç”¨å¤–å£³ | 6 | å››æ å¸ƒå±€ã€å·¥å…·/æ“ä½œæŒ‰é’®ã€ç©ºçŠ¶æ€å¼•å¯¼ã€é›¶æŠ¥é”™ |
| ç»˜å›¾å·¥å…· | 8 | R/O/F/T å››ç§å·¥å…·ã€è‡ªåŠ¨åˆ‡å›ã€è‡ªåŠ¨é€‰ä¸­ã€è¿ç»­ç»˜åˆ¶ |
| å›¾å±‚ç®¡ç† | 3 | é¢æ¿é€‰ä¸­ã€åæ ‡å±æ€§ã€ç±»å‹å›¾æ ‡ |
| å±æ€§é¢æ¿ | 6 | X/Y/W/Hã€å®½é«˜å€¼ã€å±æ€§ç¼–è¾‘ã€é€æ˜åº¦ã€é¢œè‰²ã€é€‰ä¸­åˆ‡æ¢ |
| æ˜¾ç¤ºçŠ¶æ€ | 6 | é»˜è®¤çŠ¶æ€ã€æ·»åŠ /åˆ é™¤/åˆ‡æ¢ã€åˆ é™¤æŒ‰é’®å¯è§æ€§ |
| ç”»å¸ƒå¯¼èˆª | 2 | æ»šè½®æ”¾å¤§/ç¼©å° |
| é¢„è§ˆé¢æ¿ | 4 | å¸¸é©»å¯è§ã€å›¾å±‚æ¸²æŸ“ã€äº¤äº’é›¶æŠ¥é”™ã€Level 0 è‡ªåŠ¨å¾ªç¯ |
| Patch ç¼–è¾‘å™¨ | 4 | å¸¸é©»å¯è§ã€èŠ‚ç‚¹å·¥å…·æ ã€å˜é‡æ–°å»º/åˆ é™¤ã€é¢æ¿æŠ˜å  |
| é”®ç›˜å¿«æ·é”® | 6 | V/R/O/F/T åˆ‡æ¢ã€å¿«é€Ÿè¿ç»­åˆ‡æ¢ |
| æ›²çº¿é…ç½® | 2 | å¼¹ç°§ç±»å‹ã€å“åº”/é˜»å°¼ |
| å…³é”®å±æ€§ | 1 | é€‰ä¸­åæ˜¾ç¤ºåˆ—è¡¨ |
| å¯¼å‡º | 1 | å¯¼å‡ºå¯¹è¯æ¡† |
| çŠ¶æ€é—´åŠ¨ç”»è¿‡æ¸¡ | 1 | ä¸¤çŠ¶æ€+å±æ€§+åˆ‡æ¢æ— æŠ¥é”™ |
| ç»¼åˆé›†æˆ | 3 | ç«¯åˆ°ç«¯å·¥ä½œæµ + 10 å›¾å±‚å‹åŠ›æµ‹è¯• + ä¿å­˜æ¢å¤ |
| Drag è¡Œä¸º | 1 | behaviorDrag ç»‘å®šå›¾å±‚åæ‹–æ‹½è·Ÿæ‰‹ |
| UI æ‰“ç£¨å›å½’ | 7 | çŠ¶æ€æ /å·¥å…·æ æ¿€æ´»æ€ã€æè¾¹é»˜è®¤å€¼ã€Patchæ»šåŠ¨ã€æ›²çº¿ç²¾ç¡®è¾“å…¥ã€data-testidã€spinneréšè— |
| Review #1 è¡¥ç¼º | 5 | çŠ¶æ€å‘½åæ ¼å¼ã€PatchèŠ‚ç‚¹åˆ é™¤ã€ç«¯å£æ‹–çº¿è¿æ¥ã€å˜é‡å°±åœ°åˆ›å»ºã€inputå†…å¿«æ·é”®å±è”½ |

### æºç  â†’ Feature æ˜ å°„ (æ”¹å“ªä¸ªæ¨¡å—ï¼Œè·‘å“ªä¸ªæµ‹è¯•)

| æºç æ¨¡å— | BDD Feature | grep å‚æ•° |
|---|---|---|
| `App.vue` / `Toolbar` / æ•´ä½“å¸ƒå±€ | åº”ç”¨å¤–å£³ | `åº”ç”¨å¤–å£³` |
| `useDrawTool.ts` / `DOMRenderer.ts` | ç»˜å›¾å·¥å…· | `ç»˜å›¾å·¥å…·` |
| `LayerPanel.vue` / `SceneGraph.ts` | å›¾å±‚ç®¡ç† | `å›¾å±‚ç®¡ç†` |
| `PropertiesPanel.vue` / `DisplayState.ts` | å±æ€§é¢æ¿ | `å±æ€§é¢æ¿` |
| `StateBar.vue` / `project.ts` çŠ¶æ€ | æ˜¾ç¤ºçŠ¶æ€ | `æ˜¾ç¤ºçŠ¶æ€` |
| `CanvasViewport.vue` / `canvas.ts` | ç”»å¸ƒå¯¼èˆª | `ç”»å¸ƒå¯¼èˆª` |
| `PreviewMode.vue` / `editor.ts` | é¢„è§ˆæ¨¡å¼ | `é¢„è§ˆæ¨¡å¼` |
| `PatchCanvas.vue` / `PatchRuntime.ts` | Patch ç¼–è¾‘å™¨ | `Patch` |
| `useKeyboard.ts` | é”®ç›˜å¿«æ·é”® | `é”®ç›˜å¿«æ·é”®` |
| `CurvePanel.vue` / `FolmeEase.ts` | æ›²çº¿é…ç½® | `æ›²çº¿é…ç½®` |
| `KeyPropertyPanel.vue` | å…³é”®å±æ€§ | `å…³é”®å±æ€§` |
| å¯¼å‡ºå™¨ `*Exporter.ts` | å¯¼å‡º | `å¯¼å‡º` |
| `SmartAnimate.ts` / `FolmeManager.ts` | çŠ¶æ€é—´åŠ¨ç”»è¿‡æ¸¡ | `çŠ¶æ€é—´åŠ¨ç”»` |
| `StateBar.vue` / `PropertiesPanel.vue` / `CurveEdit.vue` / `PatchCanvas.vue` æ ·å¼å˜æ›´ | UI æ‰“ç£¨å›å½’ | `UI æ‰“ç£¨å›å½’` |

### ç¼–å†™è‡ªå®šä¹‰éªŒè¯è„šæœ¬

å¦‚éœ€ä¸´æ—¶éªŒè¯ç‰¹å®šåŠŸèƒ½ï¼Œåœ¨ `tests/` ä¸‹åˆ›å»º `.spec.ts` æ–‡ä»¶:

```typescript
import { test, expect } from '@playwright/test'

test('è‡ªå®šä¹‰éªŒè¯', async ({ page }) => {
  await page.goto('http://localhost:5177')
  await page.waitForLoadState('networkidle')

  // åæ ‡çº§é¼ æ ‡æ“ä½œ (ç”»å¸ƒäº¤äº’æ ¸å¿ƒèƒ½åŠ›)
  const canvas = page.locator('.canvas-area')
  const box = await canvas.boundingBox()
  await page.mouse.move(box!.x + 300, box!.y + 300)
  await page.mouse.down()
  await page.mouse.move(box!.x + 500, box!.y + 500, { steps: 10 })
  await page.mouse.up()

  // æˆªå›¾
  await page.screenshot({ path: 'tests/screenshots/custom.png' })

  // æ§åˆ¶å°é”™è¯¯æ£€æµ‹
  const errors: string[] = []
  page.on('console', msg => { if (msg.type() === 'error') errors.push(msg.text()) })
  expect(errors).toHaveLength(0)
})
```

### æ³¨æ„äº‹é¡¹

- dev server ç«¯å£å¯èƒ½å˜åŒ– (5173~5177)ï¼Œä» `pnpm dev` è¾“å‡ºä¸­ç¡®è®¤
- æˆªå›¾ä¿å­˜åœ¨ `tests/screenshots/`ï¼ŒéªŒè¯å®Œå¯åˆ é™¤
- Playwright ç”¨ headless Chromiumï¼Œä¸ä¼šå¼¹å‡ºæµè§ˆå™¨çª—å£
- ç”»å¸ƒæ“ä½œå¿…é¡»ç”¨åæ ‡çº§ `page.mouse.*`ï¼Œä¸èƒ½ç”¨ element click
